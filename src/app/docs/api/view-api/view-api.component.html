<div class="container">

  <a class="btn btn-sm edit-page-btn" routerLink="edit" [hasPermission]="[permissions.API.UPDATE]" [hasPermissionTo]="[entityPermissions.MODIFY, entityPermissions.ADMIN]" [entity]="api">
    <clr-icon shape="pencil" class="is-solid"></clr-icon> Edit API
  </a>

  <div class="pull-right">
    <clr-tooltip *ngIf="! following && ! isEntityAdmin">
      <button clrTooltipTrigger class="ml20 btn btn-primary-outlined" (click)="follow()">Follow</button>
      <clr-tooltip-content clrPosition="top-left" clrSize="sm" *clrIfOpen style="min-width:200px;">
          <span>Get notified via Email when there are updates to the {{ api.name }}</span>
      </clr-tooltip-content>
    </clr-tooltip>

    <clr-tooltip  *ngIf="following && ! isEntityAdmin">
      <button clrTooltipTrigger class="ml20 btn btn-primary-outlined" (click)="unfollow()">Unfollow</button>
      <clr-tooltip-content clrPosition="top-left" clrSize="sm" *clrIfOpen style="min-width:200px;">
        <span>Stop receiving updates on {{ api.name }}</span>
      </clr-tooltip-content>
    </clr-tooltip>
    
    <a class="ml20 btn btn-primary-outlined" *ngIf="api.cid" [routerLink]="'/forum/category/' + api.cid"><clr-icon shape="talk-bubbles"></clr-icon> Discuss</a>
    
    <clr-tooltip *ngIf="isEntityAdmin">
      <a clrTooltipTrigger class="ml20 btn btn-primary-outlined" [routerLink]="'/forum/category/' + announcementCid"><clr-icon shape="bell"></clr-icon> Post Update</a>
      <clr-tooltip-content clrPosition="top-left" clrSize="sm" *clrIfOpen style="min-width:200px;">
          <span>Post announcement to users following this API</span>
      </clr-tooltip-content>
    </clr-tooltip>
  </div>

  <h1>{{ api.name }}</h1>

  <p class="bottom-spacer-20">{{ api.description }}</p>

  <ng-container *ngIf="(overviewSafe.changingThisBreaksApplicationSecurity && overviewSafe.changingThisBreaksApplicationSecurity.length > 30)">
    <h2>Overview</h2>

    <hr/>

    <div id="overview" class="api-documentation-content" dynamicContentRouting [innerHtml]="overviewSafe"></div>
  </ng-container>

  <ng-container *ngIf="gettingStartedSafe.changingThisBreaksApplicationSecurity && gettingStartedSafe.changingThisBreaksApplicationSecurity.length > 30">
    <h2>Getting Started</h2>

    <hr/>

    <div id="getting-started" class="api-documentation-content" dynamicContentRouting [innerHtml]="gettingStartedSafe"></div>
  </ng-container>

  <h2 id="api-documentation">
    API Documentation
    <clr-tooltip *ngIf="api.apiManagementTool">
        <a><clr-icon clrTooltipTrigger shape="key" size="30" class="ml10" (click)="openApiKeyModal()"></clr-icon></a>
        <clr-tooltip-content clrPosition="right" clrSize="sm" *clrIfOpen>
            <span>Get API Key</span>
        </clr-tooltip-content>
    </clr-tooltip>
  </h2>

  <apigee-api-key-modal *ngIf="api.apiManagementTool && api.apiManagementTool.name && api.apiManagementTool.name === 'APIGEE' " 
                        [opened]="apikeyModalOpen"
                        [api]="api"
  ></apigee-api-key-modal>

  <hr class="bottom-spacer-20"/>

  <!-- <swagger-ui class="bottom-spacer-40" [swaggerJson]="swaggerJson"></swagger-ui> -->

  <div id="swagger-ui"></div>

  <div id="swagger-editor"></div>

  <h2 id="api-reference">Reference</h2>
  
  <hr/>
  
  <div class="api-documentation-content" dynamicContentRouting [innerHtml]="referenceSafe"></div>

  <!-- <ng-container *ngIf="api.cid">
  <h2>API Forum</h2>

  <hr/>

  <a [routerLink]="'/forum/category/' + api.cid">{{ api.name }} Forum</a>  
  </ng-container> -->

</div>